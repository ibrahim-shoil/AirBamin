<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ChoiceBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.SVGPath?>

<BorderPane fx:id="rootPane" 
            xmlns="http://javafx.com/javafx" 
            xmlns:fx="http://javafx.com/fxml" 
            fx:controller="com.airbamin.desktop.ui.YouTubeDownloaderController">

    <top>
        <fx:include source="components/AppHeader.fxml"/>
    </top>

    <center>
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" styleClass="page-scroll">
            <content>
                <VBox alignment="TOP_CENTER" spacing="20" styleClass="page">

                    <VBox alignment="CENTER_LEFT" spacing="8" maxWidth="900">
                        <Label text="%downloader.title" styleClass="section-title"/>
                        <Label text="%downloader.subtitle" wrapText="true" styleClass="body-text"/>
                    </VBox>

                    <!-- URL Input Card -->
                    <VBox styleClass="card" maxWidth="800" spacing="16">
                        <Label text="%downloader.input.title" styleClass="card-title"/>
                        
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <VBox HBox.hgrow="ALWAYS" spacing="4">
                                <Label text="%downloader.input.label" styleClass="subtext"/>
                                <TextField fx:id="urlField" promptText="https://www.youtube.com/watch?v=..." HBox.hgrow="ALWAYS"/>
                            </VBox>
                            <Button text="%downloader.btn.paste" onAction="#onPasteUrl" styleClass="ghost-button">
                                <graphic>
                                    <SVGPath content="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z" styleClass="icon-small"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <HBox alignment="CENTER_RIGHT">
                            <Button fx:id="fetchButton" text="%downloader.btn.fetch" onAction="#onFetchInfo" styleClass="primary-button" disable="true"/>
                        </HBox>
                        
                        <!-- Fetching Progress (shown during fetch) -->
                        <VBox fx:id="fetchingBox" spacing="8" visible="false" managed="false">
                            <Label fx:id="fetchingStatusLabel" text="%downloader.status.fetching" styleClass="status-note"/>
                            <ProgressBar fx:id="fetchingProgressBar" progress="-1" maxWidth="Infinity" styleClass="progress-accent"/>
                        </VBox>
                    </VBox>

                    <!-- Video Info & Options (Hidden initially) -->
                    <VBox fx:id="videoInfoBox" styleClass="card" maxWidth="800" spacing="20" visible="false" managed="false">
                        <Label text="%downloader.options.title" styleClass="card-title"/>
                        
                        <HBox spacing="20" alignment="TOP_LEFT">
                            <!-- Thumbnail -->
                            <ImageView fx:id="thumbnailImage" fitWidth="240" fitHeight="135" preserveRatio="true" styleClass="info-tile"/>
                            
                            <!-- Metadata -->
                            <VBox spacing="6">
                                <Label fx:id="videoTitleLabel" styleClass="highlight-label" wrapText="true" style="-fx-font-size: 16px;"/>
                                <Label fx:id="videoChannelLabel" styleClass="body-text"/>
                                <Label fx:id="videoDurationLabel" styleClass="subtext"/>
                            </VBox>
                        </HBox>

                        <Region prefHeight="10"/>

                        <!-- Options Grid -->
                        <GridPane hgap="25" vgap="20">
                            <!-- Column 1 -->
                            <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                <Label text="%downloader.type.label" styleClass="body-text"/>
                                <ChoiceBox fx:id="downloadTypeChoice" prefWidth="250"/>
                            </VBox>

                            <HBox fx:id="qualityBox" spacing="8" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                <VBox spacing="8" HBox.hgrow="ALWAYS">
                                    <Label text="%downloader.quality.label" styleClass="body-text"/>
                                    <ChoiceBox fx:id="qualityChoice" prefWidth="250"/>
                                </VBox>
                            </HBox>

                            <HBox fx:id="audioFormatBox" spacing="8" GridPane.columnIndex="1" GridPane.rowIndex="0" visible="false" managed="false">
                                <VBox spacing="8" HBox.hgrow="ALWAYS">
                                    <Label text="%downloader.format.label" styleClass="body-text"/>
                                    <ChoiceBox fx:id="audioFormatChoice" prefWidth="250"/>
                                </VBox>
                            </HBox>

                            <!-- Column 1 Row 2 - Extras -->
                            <VBox spacing="12" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="2">
                                <Label text="%downloader.extras.label" styleClass="body-text"/>
                                <HBox spacing="20">
                                    <CheckBox fx:id="subtitlesCheck" text="%downloader.check.subtitles" styleClass="check-box"/>
                                    <CheckBox fx:id="thumbnailCheck" text="%downloader.check.thumbnail" styleClass="check-box"/>
                                </HBox>
                                
                                <!-- Subtitle language selector (shown when subtitles checked) -->
                                <VBox fx:id="subtitleLanguagesBox" spacing="8" visible="false" managed="false">
                                    <Label text="%downloader.subtitles.languages" styleClass="subtext"/>
                                    <ListView fx:id="subtitleLanguagesList" prefHeight="120" styleClass="list-view"/>
                                </VBox>
                            </VBox>
                        </GridPane>

                        <HBox alignment="CENTER_RIGHT" spacing="12">
                            <Button fx:id="cancelButton" text="%app.cancel" onAction="#onCancel" styleClass="secondary-button" visible="false" managed="false"/>
                            <Button fx:id="downloadButton" text="%downloader.btn.download" onAction="#onDownload" styleClass="primary-button">
                                <graphic>
                                    <SVGPath content="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" styleClass="icon-small" style="-fx-fill: white;"/>
                                </graphic>
                            </Button>
                        </HBox>
                        
                        <!-- Progress Area -->
                        <VBox fx:id="progressBox" spacing="8">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label fx:id="statusLabel" text="%downloader.status.ready" styleClass="status-note" HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                                <Label fx:id="speedLabel" styleClass="subtext"/>
                                <Label fx:id="etaLabel" styleClass="subtext"/>
                            </HBox>
                            <ProgressBar fx:id="progressBar" progress="0.0" maxWidth="Infinity" styleClass="progress-accent"/>
                        </VBox>
                    </VBox>

                    <!-- Footer / Output Folder -->
                    <HBox alignment="CENTER" spacing="10" styleClass="card" maxWidth="800">
                        <Label text="%downloader.output.label" styleClass="body-text"/>
                        <Label fx:id="outputFolderLabel" styleClass="subtext" wrapText="true"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button fx:id="openFolderButton" text="%downloader.btn.open_folder" onAction="#onOpenFolder" styleClass="secondary-button"/>
                    </HBox>

                </VBox>
            </content>
        </ScrollPane>
    </center>

</BorderPane>
